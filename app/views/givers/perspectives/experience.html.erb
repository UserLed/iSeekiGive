<%= render "header" %>

<%= link_to "Back to Game 2: Skills Match", game_2_giver_perspectives_path(@giver) %>

<div class="row-fluid">
  <div class="span12" style="text-align: right">
    <h2>
      <%= @experience.title %>
    </h2>
    <h4>
      <%= @experience.company_name %>
    </h4>
  </div>
</div>

<div class="row-fluid">
  <div class="skills span6">
    <% (@giver.skills - @experience.skills).each do |skill| %>
      <span class="skill_tag btn btn-info" id='skill_<%= skill.id %>'>
        <%= skill.name %>
      </span>
    <% end %>
  </div>


  <div class="span6">
    <legend>
      Drop your matching skills below:
    </legend>
    <div id="matching-skills-container">
      <% @experience.skills.each do |skill| %>
        <span class="skill_tag btn btn-info" id='skill_<%= skill.id %>'>
          <%= skill.name %>
        </span>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    $(".skills span").draggable({
      appendTo: "body",
      helper : 'clone'
    });


    droppable_div = $("#matching-skills-container");		
    giver_id = "<%= @giver.id %>";

    droppable_div.droppable({
      activeClass: "ui-state-default",
      hoverClass: "ui-state-hover",
      accept: ":not(.ui-sortable-helper)",
      drop: function(event, ui){
        var skill_span_id = ui.draggable.attr('id');
        var skill_id = skill_span_id.replace("skill_", "");

        droppable_div.append('<span class="btn btn-info skill_tag" id="' + skill_span_id + '">' + ui.draggable.text() + '</span>');
        $("#"+skill_span_id).remove();

        $.ajax({
          type: "POST",
          url: "<%= game_experience_giver_perspectives_path(@giver, @experience) %>",
          data: { skill_id: skill_id },
          dataType: "script",
          success: function(data) {
            console.log(data); 
          }
        });
      }

    });

  });
</script>
